generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id             String          @id @default(cuid())
  clerkId        String          @unique
  email          String          @unique
  firstName      String?
  lastName       String?
  profileImage   String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  lastLoginAt    DateTime?
  aiInteractions AIInteraction[]
  applications   Application[]
  interviews     Interview[]
  profile        Profile?
  resumes        Resume[]
  savedJobs      SavedJob[]

  @@index([clerkId])
  @@index([email])
  @@map("users")
}

model Profile {
  id                String          @id @default(cuid())
  userId            String          @unique
  headline          String?
  summary           String?
  location          String?
  phoneNumber       String?
  linkedinUrl       String?
  githubUrl         String?
  portfolioUrl      String?
  currentCompany    String?
  currentRole       String?
  yearsOfExperience Int?
  salaryExpectation Int?
  noticePeriod      Int?
  desiredRoles      String[]
  desiredLocations  String[]
  workType          WorkType?
  jobType           JobType?
  profileStrength   Int             @default(0)
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  certifications    Certification[]
  education         Education[]
  experience        Experience[]
  user              User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  skills            Skill[]

  @@map("profiles")
}

model Skill {
  id        String     @id @default(cuid())
  profileId String
  name      String
  level     SkillLevel
  yearsUsed Int?
  createdAt DateTime   @default(now())
  profile   Profile    @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
  @@map("skills")
}

model Experience {
  id           String    @id @default(cuid())
  profileId    String
  company      String
  role         String
  description  String?
  location     String?
  isCurrently  Boolean   @default(false)
  startDate    DateTime
  endDate      DateTime?
  achievements String[]
  technologies String[]
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  profile      Profile   @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
  @@map("experiences")
}

model Education {
  id          String    @id @default(cuid())
  profileId   String
  institution String
  degree      String
  field       String
  grade       String?
  startDate   DateTime
  endDate     DateTime?
  isCurrently Boolean   @default(false)
  createdAt   DateTime  @default(now())
  profile     Profile   @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
  @@map("education")
}

model Certification {
  id            String    @id @default(cuid())
  profileId     String
  name          String
  issuer        String
  issueDate     DateTime
  expiryDate    DateTime?
  credentialId  String?
  credentialUrl String?
  createdAt     DateTime  @default(now())
  profile       Profile   @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
  @@map("certifications")
}

model Resume {
  id            String   @id @default(cuid())
  userId        String
  fileName      String
  fileUrl       String
  fileSize      Int
  mimeType      String
  parsedContent String?
  aiAnalysis    Json?
  strengthScore Int?
  suggestions   String[]
  isActive      Boolean  @default(true)
  isPrimary     Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  wordCount     Int?
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isPrimary])
  @@map("resumes")
}

model Job {
  id               String        @id @default(cuid())
  title            String
  company          String
  location         String
  workType         WorkType
  jobType          JobType
  description      String
  requirements     String[]
  responsibilities String[]
  skills           String[]
  salaryMin        Int?
  salaryMax        Int?
  salaryCurrency   String        @default("USD")
  source           String
  externalId       String?
  externalUrl      String?
  isActive         Boolean       @default(true)
  postedAt         DateTime?
  expiresAt        DateTime?
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  applications     Application[]
  savedBy          SavedJob[]

  @@index([company])
  @@index([location])
  @@index([isActive])
  @@map("jobs")
}

model Application {
  id            String            @id @default(cuid())
  userId        String
  jobId         String
  status        ApplicationStatus @default(APPLIED)
  appliedVia    String?
  coverLetter   String?
  resumeUsed    String?
  appliedAt     DateTime          @default(now())
  lastUpdatedAt DateTime          @updatedAt
  notes         String?
  nextFollowUp  DateTime?
  job           Job               @relation(fields: [jobId], references: [id], onDelete: Cascade)
  user          User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  interviews    Interview[]

  @@index([userId])
  @@index([jobId])
  @@index([status])
  @@map("applications")
}

model SavedJob {
  id      String   @id @default(cuid())
  userId  String
  jobId   String
  notes   String?
  savedAt DateTime @default(now())
  job     Job      @relation(fields: [jobId], references: [id], onDelete: Cascade)
  user    User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, jobId])
  @@index([userId])
  @@map("saved_jobs")
}

model Interview {
  id             String          @id @default(cuid())
  applicationId  String
  userId         String
  round          Int
  type           InterviewType
  scheduledAt    DateTime
  duration       Int?
  location       String?
  interviewers   String[]
  notes          String?
  questionsAsked String[]
  feedback       String?
  status         InterviewStatus @default(SCHEDULED)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  application    Application     @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  user           User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([applicationId])
  @@map("interviews")
}

model AIInteraction {
  id         String            @id @default(cuid())
  userId     String
  type       AIInteractionType
  prompt     String
  response   String
  metadata   Json?
  tokensUsed Int?
  createdAt  DateTime          @default(now())
  user       User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([type])
  @@map("ai_interactions")
}

enum WorkType {
  REMOTE
  HYBRID
  ONSITE
}

enum JobType {
  FULL_TIME
  PART_TIME
  CONTRACT
  INTERNSHIP
  FREELANCE
}

enum SkillLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  EXPERT
}

enum ApplicationStatus {
  APPLIED
  SCREENING
  INTERVIEWING
  OFFER
  REJECTED
  ACCEPTED
  WITHDRAWN
}

enum InterviewType {
  PHONE
  VIDEO
  ONSITE
  TECHNICAL
  HR
  BEHAVIORAL
  CASE_STUDY
  FINAL
}

enum InterviewStatus {
  SCHEDULED
  COMPLETED
  CANCELLED
  RESCHEDULED
  NO_SHOW
}

enum AIInteractionType {
  RESUME_ANALYSIS
  CAREER_ADVICE
  INTERVIEW_PREP
  COVER_LETTER
  JOB_MATCH
  SALARY_NEGOTIATION
  SKILL_GAP_ANALYSIS
}
