// JobGeniusAI - Production Database Schema
// PostgreSQL with Prisma ORM

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// ============================================
// USER & PROFILE MODELS
// ============================================

model User {
  id                String    @id @default(cuid())
  clerkId           String    @unique // Synced from Clerk
  email             String    @unique
  firstName         String?
  lastName          String?
  profileImage      String?
  
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  lastLoginAt       DateTime?
  
  // Relations
  profile           Profile?
  resumes           Resume[]
  applications      Application[]
  interviews        Interview[]
  savedJobs         SavedJob[]
  aiInteractions    AIInteraction[]
  
  @@index([clerkId])
  @@index([email])
  @@map("users")
}

model Profile {
  id                String    @id @default(cuid())
  userId            String    @unique
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Professional Info
  headline          String?   // e.g., "Senior Software Engineer"
  summary           String?   @db.Text
  location          String?
  phoneNumber       String?
  linkedinUrl       String?
  githubUrl         String?
  portfolioUrl      String?
  
  // Career Details
  currentCompany    String?
  currentRole       String?
  yearsOfExperience Int?
  salaryExpectation Int?      // Annual in USD
  noticePeriod      Int?      // Days
  
  // Job Preferences
  desiredRoles      String[]  // Array of job titles
  desiredLocations  String[]  // Array of cities/countries
  workType          WorkType? // REMOTE, HYBRID, ONSITE
  jobType           JobType?  // FULL_TIME, PART_TIME, CONTRACT, INTERNSHIP
  
  // Skills & Education
  skills            Skill[]
  experience        Experience[]
  education         Education[]
  certifications    Certification[]
  
  // Profile Completion
  profileStrength   Int       @default(0) // 0-100
  
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  @@map("profiles")
}

model Skill {
  id          String   @id @default(cuid())
  profileId   String
  profile     Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)
  
  name        String
  level       SkillLevel // BEGINNER, INTERMEDIATE, ADVANCED, EXPERT
  yearsUsed   Int?
  
  createdAt   DateTime @default(now())
  
  @@index([profileId])
  @@map("skills")
}

model Experience {
  id          String    @id @default(cuid())
  profileId   String
  profile     Profile   @relation(fields: [profileId], references: [id], onDelete: Cascade)
  
  company     String
  role        String
  description String?   @db.Text
  location    String?
  isCurrently Boolean   @default(false)
  
  startDate   DateTime
  endDate     DateTime?
  
  achievements String[] // Array of key achievements
  technologies String[] // Technologies used
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  @@index([profileId])
  @@map("experiences")
}

model Education {
  id          String    @id @default(cuid())
  profileId   String
  profile     Profile   @relation(fields: [profileId], references: [id], onDelete: Cascade)
  
  institution String
  degree      String
  field       String
  grade       String?
  
  startDate   DateTime
  endDate     DateTime?
  isCurrently Boolean   @default(false)
  
  createdAt   DateTime  @default(now())
  
  @@index([profileId])
  @@map("education")
}

model Certification {
  id             String    @id @default(cuid())
  profileId      String
  profile        Profile   @relation(fields: [profileId], references: [id], onDelete: Cascade)
  
  name           String
  issuer         String
  issueDate      DateTime
  expiryDate     DateTime?
  credentialId   String?
  credentialUrl  String?
  
  createdAt      DateTime  @default(now())
  
  @@index([profileId])
  @@map("certifications")
}

// ============================================
// RESUME MODELS
// ============================================

model Resume {
  id              String        @id @default(cuid())
  userId          String
  user            User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  fileName        String
  fileUrl         String        // Cloudinary URL
  fileSize        Int           // Bytes
  mimeType        String
  
  // AI Analysis
  parsedContent   String?       @db.Text
  aiAnalysis      Json?         // Gemini AI analysis results
  strengthScore   Int?          // 0-100
  suggestions     String[]      // Improvement suggestions
  wordCount       Int?          // Number of words in resume
  
  isActive        Boolean       @default(true)
  isPrimary       Boolean       @default(false)
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  @@index([userId])
  @@index([isPrimary])
  @@map("resumes")
}

// ============================================
// JOB & APPLICATION MODELS
// ============================================

model Job {
  id                String        @id @default(cuid())
  
  // Basic Info
  title             String
  company           String
  location          String
  workType          WorkType      // REMOTE, HYBRID, ONSITE
  jobType           JobType       // FULL_TIME, PART_TIME, etc.
  
  // Details
  description       String        @db.Text
  requirements      String[]
  responsibilities  String[]
  skills            String[]
  
  // Compensation
  salaryMin         Int?
  salaryMax         Int?
  salaryCurrency    String        @default("USD")
  
  // Source
  source            String        // LINKEDIN, MANUAL, etc.
  externalId        String?       // LinkedIn job ID
  externalUrl       String?
  
  // Status
  isActive          Boolean       @default(true)
  postedAt          DateTime?
  expiresAt         DateTime?
  
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  
  // Relations
  applications      Application[]
  savedBy           SavedJob[]
  
  @@index([company])
  @@index([location])
  @@index([isActive])
  @@map("jobs")
}

model Application {
  id              String            @id @default(cuid())
  userId          String
  user            User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  jobId           String
  job             Job               @relation(fields: [jobId], references: [id], onDelete: Cascade)
  
  status          ApplicationStatus @default(APPLIED)
  
  // Application Details
  appliedVia      String?           // LinkedIn, Company Website, etc.
  coverLetter     String?           @db.Text
  resumeUsed      String?           // Resume file URL
  
  // Timeline
  appliedAt       DateTime          @default(now())
  lastUpdatedAt   DateTime          @updatedAt
  
  // Interview Tracking
  interviews      Interview[]
  
  // Notes & Follow-ups
  notes           String?           @db.Text
  nextFollowUp    DateTime?
  
  @@index([userId])
  @@index([jobId])
  @@index([status])
  @@map("applications")
}

model SavedJob {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  jobId     String
  job       Job      @relation(fields: [jobId], references: [id], onDelete: Cascade)
  
  notes     String?  @db.Text
  savedAt   DateTime @default(now())
  
  @@unique([userId, jobId])
  @@index([userId])
  @@map("saved_jobs")
}

model Interview {
  id              String        @id @default(cuid())
  applicationId   String
  application     Application   @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  userId          String
  user            User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  round           Int           // 1, 2, 3, etc.
  type            InterviewType // PHONE, VIDEO, ONSITE, TECHNICAL, etc.
  
  scheduledAt     DateTime
  duration        Int?          // Minutes
  location        String?       // Meeting link or address
  interviewers    String[]      // Names of interviewers
  
  // Preparation
  notes           String?       @db.Text
  questionsAsked  String[]
  feedback        String?       @db.Text
  
  status          InterviewStatus @default(SCHEDULED)
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  @@index([userId])
  @@index([applicationId])
  @@map("interviews")
}

// ============================================
// AI INTERACTION MODELS
// ============================================

model AIInteraction {
  id          String             @id @default(cuid())
  userId      String
  user        User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  type        AIInteractionType  // RESUME_ANALYSIS, CAREER_ADVICE, INTERVIEW_PREP, etc.
  prompt      String             @db.Text
  response    String             @db.Text
  
  metadata    Json?              // Additional context
  tokensUsed  Int?
  
  createdAt   DateTime           @default(now())
  
  @@index([userId])
  @@index([type])
  @@map("ai_interactions")
}

// ============================================
// ENUMS
// ============================================

enum WorkType {
  REMOTE
  HYBRID
  ONSITE
}

enum JobType {
  FULL_TIME
  PART_TIME
  CONTRACT
  INTERNSHIP
  FREELANCE
}

enum SkillLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  EXPERT
}

enum ApplicationStatus {
  APPLIED
  SCREENING
  INTERVIEWING
  OFFER
  REJECTED
  ACCEPTED
  WITHDRAWN
}

enum InterviewType {
  PHONE
  VIDEO
  ONSITE
  TECHNICAL
  HR
  BEHAVIORAL
  CASE_STUDY
  FINAL
}

enum InterviewStatus {
  SCHEDULED
  COMPLETED
  CANCELLED
  RESCHEDULED
  NO_SHOW
}

enum AIInteractionType {
  RESUME_ANALYSIS
  CAREER_ADVICE
  INTERVIEW_PREP
  COVER_LETTER
  JOB_MATCH
  SALARY_NEGOTIATION
  SKILL_GAP_ANALYSIS
}
